<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>本格オセロ - GitHub Pages</title>
    <style>
        /* 全体の背景を落ち着いた緑色に設定 */
        body { 
            font-family: 'Helvetica Neue', Arial, sans-serif; 
            text-align: center; 
            background: #2e7d32; 
            color: white; 
            margin: 0;
            padding: 20px;
        }

        h1 { margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }

        .info-panel {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 15px;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .status { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .score { font-size: 18px; color: #ecf0f1; }

        /* 盤面：背景を黒にすることで gap が「線」に見える */
        #board { 
            display: grid; 
            grid-template-columns: repeat(8, 1fr); 
            grid-template-rows: repeat(8, 1fr);
            width: 90vw; 
            max-width: 400px; 
            height: 90vw; 
            max-height: 400px;
            margin: 0 auto; 
            background: #000000; /* 線の色 */
            border: 4px solid #000000; 
            gap: 2px; /* 線の太さ */
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }

        /* マス目 */
        .cell { 
            background: #2e7d32; /* マスの緑色 */
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative;
            cursor: pointer;
        }

        /* 石のデザイン */
        .piece { 
            width: 85%; height: 85%; border-radius: 50%; 
            transition: all 0.4s ease-out;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        .black { background: #111; }
        .white { background: #fff; }

        /* ガイド（置ける場所） */
        .guide { 
            width: 12px; height: 12px; 
            background: rgba(255,255,255,0.25); 
            border-radius: 50%; 
        }
        .cell:hover .guide { background: rgba(255,255,255,0.5); }

        /* リセットボタン */
        button { 
            margin-top: 30px; 
            padding: 12px 35px; 
            font-size: 18px; 
            font-weight: bold;
            background: #c62828; 
            color: white; 
            border: none; 
            border-radius: 30px; 
            cursor: pointer;
            box-shadow: 0 4px 0 #8e0000;
        }
        button:active { transform: translateY(2px); box-shadow: 0 2px 0 #8e0000; }
    </style>
</head>
<body>

    <h1>Othello Online</h1>
    
    <div class="info-panel">
        <div class="status" id="msg">黒の番です</div>
        <div class="score" id="score">黒: 2 / 白: 2</div>
    </div>

    <div id="board"></div>

    <button onclick="init()">ゲームをリセット</button>

<script>
    let board = [];
    let turn = 1; // 1:黒, 2:白

    // ゲームの初期化
    function init() {
        board = Array.from({length: 8}, () => Array(8).fill(0));
        board[3][3] = board[4][4] = 2; // 白
        board[3][4] = board[4][3] = 1; // 黒
        turn = 1;
        draw();
    }

    // 画面の再描画
    function draw() {
        const boardElm = document.getElementById('board');
        boardElm.innerHTML = '';
        let canMoveCount = 0;

        for (let y = 0; y < 8; y++) {
            for (let x = 0; x < 8; x++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                
                const flipCount = checkFlip(x, y, turn, false);
                
                if (board[y][x] === 1) {
                    cell.innerHTML = '<div class="piece black"></div>';
                } else if (board[y][x] === 2) {
                    cell.innerHTML = '<div class="piece white"></div>';
                } else if (flipCount > 0) {
                    cell.innerHTML = '<div class="guide"></div>';
                    cell.onclick = () => { place(x, y); };
                    canMoveCount++;
                }
                boardElm.appendChild(cell);
            }
        }
        
        updateUI(canMoveCount);
    }

    // UI情報の更新
    function updateUI(canMoveCount) {
        const msg = document.getElementById('msg');
        const scoreElm = document.getElementById('score');
        const score = getScore();
        
        scoreElm.innerText = `黒: ${score.b} 枚 / 白: ${score.w} 枚`;

        if (canMoveCount === 0) {
            // パスまたは終局判定
            const nextPlayer = (turn === 1) ? 2 : 1;
            if (hasAnyMove(nextPlayer)) {
                msg.innerText = (turn === 1 ? "黒" : "白") + "はパスです";
                turn = nextPlayer;
                setTimeout(draw, 1000);
            } else {
                msg.innerText = `終局！ ${score.b > score.w ? '黒の勝ち' : score.w > score.b ? '白の勝ち' : '引き分け'}`;
            }
        } else {
            msg.innerText = (turn === 1 ? "黒" : "白") + "の番です";
        }
    }

    // 石を置く処理
    function place(x, y) {
        checkFlip(x, y, turn, true);
        board[y][x] = turn;
        turn = (turn === 1) ? 2 : 1;
        draw();
    }

    // 挟める石があるかチェック / ひっくり返す
    function checkFlip(x, y, color, doFlip) {
        if (board[y][x] !== 0) return 0;
        let total = 0;
        const dirs = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];

        for (let [dy, dx] of dirs) {
            let tx = x + dx, ty = y + dy;
            let cells = [];
            while (ty>=0 && ty<8 && tx>=0 && tx<8 && board[ty][tx] !== 0 && board[ty][tx] !== color) {
                cells.push([ty, tx]);
                ty += dy; tx += dx;
            }
            if (ty>=0 && ty<8 && tx>=0 && tx<8 && board[ty][tx] === color && cells.length > 0) {
                total += cells.length;
                if (doFlip) cells.forEach(([py, px]) => board[py][px] = color);
            }
        }
        return total;
    }

    // 指定した色のプレイヤーが打てる場所があるか
    function hasAnyMove(color) {
        for(let y=0; y<8; y++) for(let x=0; x<8; x++) if(checkFlip(x, y, color, false) > 0) return true;
        return false;
    }

    // スコア集計
    function getScore() {
        let b = 0, w = 0;
        board.flat().forEach(v => { if(v===1) b++; if(v===2) w++; });
        return {b, w};
    }

    init();
</script>
</body>
</html>